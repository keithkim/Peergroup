<h1>Communication</h1>

<h2>Lamport Timestamp</h2>

<ul>
<li>Independent logical clocks for
<ul>
<li>FileList revisions</li>
<li>File revisions</li>
<li>Sent messages</li>
</ul></li>
</ul>

<h2>New joining node</h2>

<ul>
<li>If alone:
<ul>
<li>Apply changes locally</li>
</ul></li>
<li>If other nodes available:
<ul>
<li>send: getFileListRevision</li>
<li>other nodes start sending their filelist-revision-no.</li>
<li>recv: list of filelist-revision-no.</li>
<li>request list from node with highes no. (rnd if several nodes have same no.)</li>
<li>simultaneously collcet update messages and apply to received FileList</li>
</ul></li>
</ul>

<h2>Node leaving channel</h2>

<ul>
<li>"Bye"</li>
<li>other: remove node from peerlist of blocks</li>
</ul>

<h2>Channle messages</h2>

<ul>
<li>Update file
<ul>
<li>path (incl name)</li>
<li>affected blocks + their hashes (not blocks themselves)</li>
<li>new filehash</li>
<li>timestamp</li>
</ul></li>
<li>Add file
<ul>
<li>path (incl name)</li>
<li>list of block hashes</li>
<li>filehash</li>
<li>timestamp</li>
</ul></li>
<li>Delete file
<ul>
<li>filehash</li>
</ul></li>
<li>Block complete
<ul>
<li>filehash</li>
<li>block no</li>
<li>blockhash</li>
</ul></li>
<li>File complete
<ul>
<li>filehash</li>
</ul></li>
</ul>

<h1>Datastructure</h1>

<h2>FileList</h2>

<p>List of current files, contains:</p>

<ul>
<li>List of FileHandles</li>
<li>revision no</li>
</ul>

<h2>FileHandle</h2>

<p>A file handle responsible for a single file, contains:</p>

<ul>
<li>path (relative to selected folder)</li>
<li>revision no</li>
<li>List of FileBlocks</li>
<li>needs update</li>
<li>hash</li>
</ul>

<h2>FileBlock</h2>

<p>Info about a specific file block, contains:</p>

<ul>
<li>block no.</li>
<li>revision no</li>
<li>block hash</li>
<li>needs update</li>
<li>complete</li>
<li>List of Devices where available</li>
</ul>

<h2>Device</h2>

<p>Device logged into the channel</p>

<ul>
<li>XMPP ID (a@b.cd/machine)</li>
<li>IP</li>
<li>Port</li>
</ul>
